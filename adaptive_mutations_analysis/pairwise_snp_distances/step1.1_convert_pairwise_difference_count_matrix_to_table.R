
# This R script is used to convert the matrix of pairwise SNP counts generated by pairsnp to a table format

dir = "/project/directory/";

setwd(dir);

matrix_file = "colonising_collections_all_CCs.EMRSA15.rmMGE.richardson2018_core_genome.pairwiseSNPcount.matrix.csv"

table_file = "colonising_collections_all_CCs.EMRSA15.rmMGE.richardson2018_core_genome.pairwiseSNPcount.matrix.txt"

lmM = read.delim(matrix_file,sep=",",header=F)
dim(lmM)

laSamples = as.vector(lmM[,1])
length(laSamples)

lmM = lmM[,-1]

dim(lmM)


lmT = mat.or.vec(1,3)

for(s in 1:length(laSamples))
{
  print(s)
  lsSample1 = laSamples[s];
  lmTemp = mat.or.vec(length(laSamples),3)
  lmTemp[,1] = lsSample1
  lmTemp[,2] = laSamples
  lmTemp[,3] = as.vector(as.character(lmM[s,]))
  lmT = rbind(lmT,lmTemp)
}

lmT = lmT[-1,];

### Removing same sample comparisons (matrix diagonal)

tmp = which(lmT[,1] == lmT[,2])
length(tmp)

lmT = lmT[-tmp,];

### Removing duplicated comparisons

orderComparisonId=function(x){ vec = as.vector(unlist(strsplit(x,"-"))); vec = sort(vec); y = paste(vec,collapse="-"); return(y);  }

# Creating a comparison Id

comparisonId = paste(lmT[,1], lmT[,2], sep = "-")

# Sorting samples within the comparison Ids (to make sure the same sample comparisons get the same Id)

comparisonIdSorted = sapply(comparisonId, orderComparisonId);

# Identifying repeated comparisons

tmp = which(duplicated(comparisonIdSorted)==TRUE);

# Removing repeated comparisons

lmT = lmT[-tmp,];

dim(lmT)

colnames(lmT)=c("Taxon1","Taxon2","SNPs")

write.table(lmT,file=table_file,sep="\t",col.names=T,row.names=F,quote=F)

